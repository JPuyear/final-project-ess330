---
title: "data exploration"
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

```{r}
library(tidyverse)
library(sf)
library(tigris)
library(ggplot2)
library(patchwork)  

options(tigris_use_cache = TRUE)

```
The first dataset is an EPA summary of various pollutants organized geographically. For our purposes, we will be only analyzing the CO2 measurements. The second set is google mobility data taken during the COVID-19 pandemic, measuring how different counties increased or decreased transportation frequency and usage.

cleaning:
```{r}


co2_data <- read_csv("data/co2_emissions.csv") %>%
  mutate(
    FIPS = str_pad(FIPS, 5, pad = "0"),
    Emissions_Tons = `Emissions (Tons)`
  )


mobility_data <- read_csv("data/mobility_data.csv") %>%
  mutate(
    FIPS = str_pad(census_fips_code, 5, pad = "0")
  ) %>%
  group_by(FIPS) %>%
  summarize(
    avg_residential = mean(residential_percent_change_from_baseline, na.rm = TRUE)
  )


```

```{r}
joined_data <- co2_data %>%
  inner_join(mobility_data, by = "FIPS")

us_counties <- counties(cb = TRUE, class = "sf") %>%
  mutate(FIPS = paste0(STATEFP, COUNTYFP))

map_data <- us_counties %>%
  left_join(joined_data, by = "FIPS")



```
Plotting the data:

```{r}
map_co2 <- ggplot(map_data) +
  geom_sf(aes(fill = Emissions_Tons), color = NA) +
  scale_fill_viridis_c(option = "plasma", trans = "log10", na.value = "grey90") +
  labs(title = "CO₂ Emissions (Tons)", fill = "Emissions") +
  theme_minimal()

map_mobility <- ggplot(map_data) +
  geom_sf(aes(fill = avg_residential), color = NA) +
  scale_fill_viridis_c(option = "cividis", na.value = "grey90") +
  labs(title = "Avg. Residential Mobility Change", fill = "% Change") +
  theme_minimal()

map_co2 + map_mobility +
  plot_layout(ncol = 2) +
  plot_annotation(title = "County-Level CO₂ Emissions vs. Mobility Change")

map_co2 + map_mobility +
  plot_layout(ncol = 2) +
  plot_annotation(title = "County-Level CO₂ Emissions vs. Mobility Change")


```
t test:

This suggests that CO2 levels and mobility are highly interrelated.
```{r}

joined_data <- joined_data %>%
  mutate(emissions_group = if_else(Emissions_Tons > median(Emissions_Tons, na.rm = TRUE), "High", "Low"))


t_test_result <- t.test(avg_residential ~ emissions_group, data = joined_data)

t_test_result




```

lin reg:

this test further supports the idea that CO2 emissions were a significant predictor of mobility during 2020.

```{r}
model <- lm(avg_residential ~ Emissions_Tons, data = joined_data)

summary(model)


```